{"componentChunkName":"component---src-templates-post-jsx","path":"/Ubuntu-서버에서-메모리-사용량-확인-및-스왑-설정으로-안정성-높이기/","result":{"data":{"site":{"siteMetadata":{"title":"SharkniA"}},"markdownRemark":{"id":"fc1ca32a-2bbd-5396-afb8-a2b1405ba9c3","excerpt":"서론 최근에 메모리가 1GB 미만인 오라클 클라우드 서버를 운용하면서 1GB 미만의 소형 Ubuntu 서버에서 여러 Docker 컨테이너(FastAPI 기반) 서비스를 운영하면서 메모리 부족 문제로 인해 시스템이 비정상적으로 느려지는 문제를 겪었습니다. Dev와 Prod를 한 서버에 다른 컨테이너로 두고 있었는데, 두 개의 배포가 동시에 이뤄질때엔 사용 …","html":"<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0e65e2f1157a80ef903fb91000c06116/e8464/image1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 66.47058823529413%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVR42lVSy47aQBC0/BybsbENXsCv8QuMWfMyoIXskkOk5LbKIR+Qy142n7Bfn2rDRopUGsx0V1d1T0uyGyujXB2XN2gPlTZZaJNany71cGXEj0bcsmTN0g1Lt0zsTCAD9oAk85kaVPqsMSIkbVm6Y2KPPCNZEw0EpOadmR96dISeaeWdJNt3MulElI0k8OlmWhMmC30y14Cg0uAONn2hjQsrh7ITwu2dHMMedA7QlJ1IGcaKEyHh84OguKniJqqfmaSM/6gX9K2iT/hPNjgpY5TjVIYRDSKojLBhAqEl+EQuDpKMquMCUGlUc/VzYH15ofT6cA6+s/nqnr6jhOKl6iizyqNENkYFDTyoqPmwMcsDdMBRvRSysh1SzjCxqs5un/VZTSE/t6qTpHgC9vQpprIw89305+/Zrzf/+ora8IY8bZzz9oWvLoPmzMQal6pHPfdkP9Me5nZ9tsTW3X/L/nyI9w9kQwr30MSo/ZdX9/QDpVnSakF50yMyftCkXT85y7NdnZz11W6vZtFZ1ZGJVh5MFC9h2cYsdlbZDRZH1CLbIKNnsjEujHBpRCsE+OoLX154fearZ95c+mknaJvAgdlthKonzGQjUbh/OtmJsTBG1PDmzBcnXj9hN+lVYBIC/u3sQbYLRCUU/sfHG+DlZLvfB/uu8B8NAwpKWrsI6/j4F05SST4A9pwvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image1' title='' src='/static/0e65e2f1157a80ef903fb91000c06116/ca1dc/image1.png' srcset='/static/0e65e2f1157a80ef903fb91000c06116/e7570/image1.png 170w,\n/static/0e65e2f1157a80ef903fb91000c06116/f46e7/image1.png 340w,\n/static/0e65e2f1157a80ef903fb91000c06116/ca1dc/image1.png 680w,\n/static/0e65e2f1157a80ef903fb91000c06116/02d09/image1.png 1020w,\n/static/0e65e2f1157a80ef903fb91000c06116/9d567/image1.png 1360w,\n/static/0e65e2f1157a80ef903fb91000c06116/e8464/image1.png 1536w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>서론</h2>\n<p>최근에 메모리가 1GB 미만인 오라클 클라우드 서버를 운용하면서 1GB 미만의 소형 Ubuntu 서버에서 여러 Docker 컨테이너(FastAPI 기반) 서비스를 운영하면서 메모리 부족 문제로 인해 시스템이 비정상적으로 느려지는 문제를 겪었습니다. Dev와 Prod를 한 서버에 다른 컨테이너로 두고 있었는데, 두 개의 배포가 동시에 이뤄질때엔 사용 불가능할 정도의 느려짐 현상을 겪었고, 모니터링 툴로 확인하니 평상시에 이미 메모리가 80% 이상 차있는 것을 확인해 이게 원인임을 직감했습니다. </p>\n<p>이 문제를 해결하기 위해 서버의 메모리 사용 상황을 점검하고, 필요에 따라 스왑을 설정하여 서버의 안정성을 확보하는 작업을 진행했습니다. 그 과정을 기록합니다. </p>\n<h2><strong>현재 메모리 사용량 확인</strong></h2>\n<p>오라클 클라우드의 모니터링 기능을 활용할 수도 있지만, 우분투 내에서 한 번 더 확인해봤습니다. 다음의 명령어를 사용했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">free</span> <span class=\"token parameter variable\">-h</span></code></pre></div>\n<p>이 명령을 통해 used, free, available, buff/cache 등의 메모리 상태를 한눈에 파악할 수 있습니다. 사용 중이던 서버는 물리 메모리가 약 950MiB 수준이었고, 여유 공간이 100MiB도 되지 않아 매우 불안정한 상태였습니다.</p>\n<h2><strong>컨테이너별 메모리 사용량 확인</strong></h2>\n<p>다음의 명령어를 사용해 실시간으로 어떤 컨테이너가 메모리를 많이 사용하고 있는지 확인할 수 있습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> stats</code></pre></div>\n<p>dev용 postgresql db까지 한 번에 돌리고 있어서 그게 원인일 줄 알았지만 그렇진 않았습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CONTAINER ID   NAME                      CPU %     MEM USAGE / LIMIT     MEM %     <span class=\"token punctuation\">..</span>.\n92c25148aa93   FastAPIWeb                <span class=\"token number\">32.89</span>%    <span class=\"token number\">81</span>.21MiB / <span class=\"token number\">956</span>.8MiB   <span class=\"token number\">8.49</span>%\nfe46e4749d6c   FastAPIWeb-dev            <span class=\"token number\">49.39</span>%    <span class=\"token number\">103</span>.9MiB / <span class=\"token number\">956</span>.8MiB   <span class=\"token number\">10.86</span>%\n8aba5cb599d8   dev-db                    <span class=\"token number\">0.00</span>%     <span class=\"token number\">39</span>.73MiB / <span class=\"token number\">956</span>.8MiB   <span class=\"token number\">4.15</span>%\n7983c11822e3   python_app                <span class=\"token number\">0.00</span>%     <span class=\"token number\">44</span>.13MiB / <span class=\"token number\">956</span>.8MiB   <span class=\"token number\">4.61</span>%</code></pre></div>\n<p>결과적으로 FastAPI 기반의 컨테이너들이 상대적으로 메모리를 가장 많이 사용 중이었지만, <strong>절대적인 사용량 자체는 높지 않음</strong>을 확인할 수 있었습니다. 퍼센테이지가 높은것은 워낙 전체 시스템 메모리가 작기 때문에 상대적으로 눈에 띄는 것일 뿐입니다.</p>\n<h2>Swap 파일 설정으로 안정성 확보</h2>\n<p>메모리가 부족한 상황에서 Linux 시스템이 강제 종료 없이 버티도록 하기 위해 스왑 공간을 추가로 설정했습니다. 스왑은 디스크 공간을 메모리처럼 사용하는 방식을 의미합니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 1GB swap 파일 생성</span>\n<span class=\"token function\">sudo</span> fallocate <span class=\"token parameter variable\">-l</span> 1G /swapfile\n\n<span class=\"token comment\"># 올바른 권한 설정</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> <span class=\"token number\">600</span> /swapfile\n\n<span class=\"token comment\"># 스왑 포맷 지정</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkswap</span> /swapfile\n\n<span class=\"token comment\"># 스왑 활성화</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">swapon</span> /swapfile\n\n<span class=\"token comment\"># 재부팅 시에도 적용되도록 /etc/fstab에 등록</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'/swapfile none swap sw 0 0'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">-a</span> /etc/fstab</code></pre></div>\n<p>설정이 끝난 후 다시 free -h 명령어로 확인한 결과,</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Swap:          <span class=\"token number\">1</span>.0Gi       259Mi       764Mi</code></pre></div>\n<p>약 260MiB가 이미 스왑으로 사용 중임을 확인했습니다. </p>\n<h2>결론</h2>\n<p>급한불은 껐다고 할 수 있지만, 결국 현재 너무 사양이 좋지 않기 때문에 실서버용 클라우드를 하나 더 만드는 것이 현명해보입니다. (동시 배포의 경우 CPU 점유율도 엄청나게 오릅니다. )</p>","frontmatter":{"title":"\nUbuntu 서버에서 메모리 사용량 확인 및 스왑 설정으로 안정성 높이기","date":"May 02, 2025","update":"May 02, 2025","tags":["DevOps","Ubuntu"],"series":"취미생활 - FastAPI 서버 구성"},"fields":{"slug":"/Ubuntu-서버에서-메모리-사용량-확인-및-스왑-설정으로-안정성-높이기/","readingTime":{"minutes":4.51}}},"seriesList":{"edges":[{"node":{"id":"de24f32b-02cd-55dc-8a4f-2d6d3b167304","fields":{"slug":"/오라클-서버-https-인증서-설치하기/"},"frontmatter":{"title":"오라클 서버 https 인증서 설치하기"}}},{"node":{"id":"b1be2bcf-85db-5aa6-96b9-fadfa8cb5016","fields":{"slug":"/prepared-statement-does-not-exist-오류/"},"frontmatter":{"title":"prepared statement does not exist  오류"}}},{"node":{"id":"fc1ca32a-2bbd-5396-afb8-a2b1405ba9c3","fields":{"slug":"/Ubuntu-서버에서-메모리-사용량-확인-및-스왑-설정으로-안정성-높이기/"},"frontmatter":{"title":"\nUbuntu 서버에서 메모리 사용량 확인 및 스왑 설정으로 안정성 높이기"}}}]},"previous":{"fields":{"slug":"/prepared-statement-does-not-exist-오류/"},"frontmatter":{"title":"prepared statement does not exist  오류"}},"next":{"fields":{"slug":"/Django와-MySQL에서-DB-Sleep으로-인한-Hang-문제-해결-방안/"},"frontmatter":{"title":"Django와 MySQL에서 DB Sleep으로 인한 Hang 문제 해결 방안"}}},"pageContext":{"id":"fc1ca32a-2bbd-5396-afb8-a2b1405ba9c3","series":"취미생활 - FastAPI 서버 구성","previousPostId":"b1be2bcf-85db-5aa6-96b9-fadfa8cb5016","nextPostId":"f3ecc3d6-83df-5a75-91cc-ef3e294b3e16"}},"staticQueryHashes":[],"slicesMap":{}}