---
IDX: "NUM-68"
tags:
  - Hobby
  - Blogging
update: "2024-02-02T16:32:00.000Z"
date: "2023-10-23"
상태: "Ready"
title: "vercel 배포 자동화"
---
어느 순간 morethan-log에 노션 글 업로드가 잘 되지 않았다. 



글을 그 동안 마구 마구 써버리긴 했다.. 그래서 찔리는 점이 있었는데, 최근 이직 후 일을 하면서 조금 덜 쓰면서, 그리고 잠깐 옵시디언으로 한 눈을 팔면서 고칠 생각을 안하고 있었다. 

그러면서 일도 쪼끔 익숙해지고 옵시디언도 아 별로다 라고 결론을 내고 다시 여기에 글을 썼는데, 업로드가 되지 않는걸 보니 결국은 고쳐야 할 때가 왔음을 알게 됐다. 



morethan-log는 일정 시간마다 특정 api를 호출해서 노션에서 글을 긁어오는 함수를 실행한다. 

그리고 vercel에서는 그 api가 실행한 함수의 실행 로그를 볼 수 있다… 



로그를 봤더니 예상과 같았다. 

무료 플랜에서는 함수 실행 시간을 10초까지만 허용하는데, 10초를 당연한듯이 넘고 있었다. 



notion 비공식 api를 호출하는건데.. 

deploy를 직접 했을땐 제대로 긁어오는 것으로 보아 api가 막힌 것 같진 않고 글이 많아지면서 발생한 것 같다.. 

길게 고민하지 않고 Vercel의 Deploy hooks와 Pipedream의 기능의 무료 기능들만 사용해서 매일 새벽 두시에 자동 배포를 하기로 했다. 

### Vercel Deploy Hooks

Vercel의 Deploy Hooks 기능을 이용하면 특정 URL에 HTTP 요청이 이뤄질 때마다 사이트를 다시 빌드하고 배포할 수 있다. 

내 프로젝트를 고르고, Setting를 고른 다음 좌측의 Git을 고른다. 

Deploy Hooks로 이동해서 `Create Hook`을 해 url을 생성한다. 이제 해당 URL로 접속하면 deploy 되는것을 볼 수 있다. 

### Pipedream 설정

Pipedream은 서로 다른 애플리케이션, 데이터 및 API를 연결하고 자동화 하는데 사용할 수 있는 서버리스 통합 플랫폼이다. 단적으로, 이번엔 내가 원하는 시간에 Hook을 위한 URL을 호출하도록 스케쥴링 할 수 있다. 

Pipedream 대시보드에서 `New`를 클릭하고 `Workflow`를 선택하여 새 워크플로우를 생성한다. 

트리거로 `Schedule` 을 선택하고 원하는 스케쥴을 설정한다. 

`Send Http Request` 를 선택하고, Vercel Deploy Hooks URL을 입력한다. 

테스트 후, 저장 및 배포한다. 



이로써 매일 사이트를 다시 배포하고 빌드함으로써 블로깅에 아무 문제가 없게 되었다. 

해피~

