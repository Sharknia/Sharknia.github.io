---
tags:
  - DataBase
update: "2024-02-01"
date: "2023-08-18"
상태: "Ready"
title: "DB 튜닝 경험"
---
DB 

처음에는 단순히 코드 짜는것에만 집중했었는데, 어느 순간 단순한 에러 고침 또는 간단한 로직 수정을 넘어서 더 큰 의미의 유지보수 또는 고도화를 겪으면서 DB 튜닝이 속도에 큰 영향을 미침을 인지하고, 더 빠른 페이지를 만드는것에 집중했다.



그때 아래와 같은 것들을 시도하였다.



- 인덱싱 : 자주 사용하는, 자주 불려오는 테이블들, 자주 사용되는 컬럼에 대해 인덱싱

    - 인덱싱이란?

        - 데이터를 빠르게 조회하기 위한 자료구조(B-tree 등)

        - 색인과 유사한 개념

        - 특정행을 찾기 위한 경로를 미리 만들어 두는 것과 같아 검색 시간을 크게 줄일 수 있다. 

    - 인덱싱 사용할 때 주의할 점

        - 추가적인 공간을 사용하므로 무작정 늘려서는 안된다. 가장 자주 조회되는 

        - 복합 인덱스 생성시에는 가장 많이 쿼리되는 열을 인덱스의 앞부분에 둔다. 

        - 인덱스는 쓰기 연산(Insert, Update, Delete)시에 유지 비용이 발생(쉽게 생각하면 색인을 새로 만들어야 하므로)하므로 연산이 빈번하게 일어나는 테이블에 대해 많은 인덱스를 만들면 성능 저하가 일어날 수 있음 

- 쿼리 최적화 

    - 불필요한 컬럼 제거(select *(스타) 지양)

    - 서브쿼리 대신 조인 사용

    - 데이터 타입을 최적화 하기 위해 노력(적절한 크기 지정, 숫자형이나 날짜형 형식을 주의해서 용도에 맞게 사용, 예를 들면 idx로 사용할건데 또는 학번에는 숫자만 사용되는데 varchar형식으로 선언되는 경우도 있었는데 그런 경우를 피하기 위해 노력)

- 정규화와 반정규화

    - 회사의 테이블들이 중복된 데이터들이 저장되어있는 경우가 많았다. 따라서 데이터의 무결성을 해치거나 해치지 않더라도 유지보수에 어려움을 야기하는 경우가 자주 발생 → 이런것들을 최대한 피하고 싶어서 직접 설계한 스키마는 이런것들을 최대한 피하고자 했다. 중복 데이터를 피하기 위한 정규화를 진행.

    - 정규화를 빈틈없이 했더니 테이블이 많이 쪼개지고, 중복된 데이터들이 하나도 없어서 조인을 여러 테이블을 해야 하는 경우가 많았다. 정규화를 한 경우에는 반드시 자체 협업툴에 스키마에 대한 문서를 남겼다(정규화가 덜 된 테이블에 비해 상대적으로 알아보기 어려우므로).  또한, 정규화된 테이블들을 이쁘게 조인해서 뷰로 만들어서 문서로 함께 제공했다. 

    - 소수의 데이터만 필요한데 조인을 너무 많이 해야 하는 경우나, 특정 집계 결과가 필요한 경우 또는 학생의 역량별 성적같이 조회가 많은데 잦은 계산이 필요한 경우 에는 반정규화를 하기도 했다. 반정규화를 한 경우에는, 테이블 관리(update, insert, edit등)하는 코드를 가능한 한 한군데로 모으고 자체 협업툴에 문서를 자세히 적어서 다른 개발자가 유지보수 시 최대한 알 수 있도록 했다. 

    



