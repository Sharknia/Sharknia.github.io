---
tags:
  - AWS
update: "2024-01-31"
date: "2023-10-25"
상태: "Ready"
title: "AWS ECS(Elastic Container Service)"
---
## 개요

AWS ECS는 Docker 컨테이너를 쉽게 실행, 중지 및 관리할 수 있도록 해주는 컨테이너 오케스트레이션 서비스이다. 컨테이너 배포, 작업 정의, 서비스 정의, 클러스터 관리 등을 지원한다. 

### 오케스트레이션 서비스란?

- 컨테이너의 배포, 관리, 스케일링, 네트워킹 및 가용성을 자동화하는 프로세스 및 도구의 집합이다. 
- 즉, 컨테이너화된 애플리케이션의 라이프사이클을 관리하는 것을 의미한다. 

## 주요 특징

### 서비스 

여러 개의 작업 인스턴스를 관리하며, 로드 밸런싱과 함께 사용하여 트래픽 분산을 지원한다. 

### 클러스터

컨테이너를 실행하는데 사용되는 논리적인 그룹이다. ECS에서 실행되는 리소스의 집합을 의미한다. 클러스터는 EC2 인스턴스나 Fargate 인스턴스를 포함할 수 있다. 

클러스터를 사용하여 워크로드와 관련된 리소스를 논리적으로 그룹화 할 수 있다. 예를 들면 “production” 클러스터와 “development” 클러스터를 별도로 운영할 수 있다. 

기본적으로 단순한 논리적 이름을 지닌 메타 데이터 구조체로, 클러스터 안의 실제 컴퓨팅 리소스와 독립적이다. 

### 네임스페이스

리소스를 논리적으로 분리하고 관리하기 위한 도구이다. 동일한 도메인 이름 아래에서 운영되는 서비스들의 논리적 그룹의 형성에 사용된다. 

### 테스크

단일 컨테이너 또는 여러 컨테이너의 그룹이다. 

`작업 정의` : 컨테이너의 속성을 정의하는 JSON 템플릿이다. CPU, 메모리 할당, 네트워크 모드, 사용할 도커 이미지 등을 포함한다. 

테스크는 작업 정의에 정의된 내용에 따라 실행된다. 예를 들면 웹 서버와 관련된 데이터베이스를 함께 실행하는 테스크를 생성할 수 있다. 

## 순서와 구조

1. 컨테이너

    독립적으로 실행 가능한 소프트웨어의 최소 단위. AWS ECS에서는 이 컨테이너를 EC2 인스턴스나 Fargate에서 실행할 수 있다.  

1. 테스크

    ECS의 실행 단위, 하나 이상의 컨테이너로 구성됨

1. 클러스터

    테스크와 서비스를 실행하고 관리하는 논리적 단위

1. 네임스페이스

    서비스와 관련된 논리적 그룹을 형성

1. ECS

각 단계는 이전 단계의 구성 요소를 더 큰 단위로 그룹화하거나 관리하는 역할을 한다. 

## 웹 애플리케이션의 개발 후 ECS 배포

1. 웹 애플리케이션 개발

    웹 애플리케이션을 개발한다. 

    로컬에서 테스트하여 작동을 확인한다. 

1. Docker 이미지 생성

    `Dockerfile` 을 작성하여 웹애플리케이션을 컨테이너화 한다. 

    로컬에서 Docker를 사용하여 이미지를 빌드하고 테스트한다. 

1. Docker 이미지를 ECR(Elastioc Container Registry)에 푸시

    AWS ECR에 저장소를 생성한다. 

    로컬에서 빌드한 Docker 이미지를 ECR 저장소에 PUSH 한다. 

1. ECS 클러스터 및 작업 정의 설정

    ECS 클러스터를 생성한다. (Fargate 또는 EC2 인스턴스)

    작업 정의(Task Definition)을 생성한다. 작업 정의에는 ECR에수 푸시한 Docker 이미지, 필요한 CPU와 메모리, 환경 변수, 포트 매핑 등을 지정한다. 

1. ECS 서비스 생성

    ECS 클러스터 내에서 작업정의를 기반으로 서비스를 생성한다. 서비스를 사용하면 컨테이너의 실행 상태를 유지하거나 원하는 개수의 작업 인스턴스를 실행할 수 있다. 

1. 도메인 및 DNS 설정

    AWS Route 53을 사용하여 도메인을 설정하고 ALB(Application Load Balancer) 의 주소를 해당 도메인에 연결한다. 

1. 보안 그룹 및 네트워크 설정

1. 모니터링 및 로깅

## 기존 서비스에서 ECS 기반 서비스로의 전환

1. ECS, Fargate 설정

1. ALB 설정

    Application Load Balancer를 생성한다. 

    리스너와 타겟 그룹을 설정하여 ECS 서비스의 작업에 트래픽을 라우팅 하도록 한다. 

1. Route 53 업데이트

    현재 서비스에 연결된 Route53 레코드를 수정하여 ALB의 DNS 이름을 가리키도록 변경한다. 

1. 모니터링 및 튜닝

### 주의점

기본적으로는 CES, Fargate, ALB를 설정한 후 마지막 단계로 Route 53의 레코드 설정만 변경하면 트래픽은 새로운 ECS-Fargate 기반의 서비스로 라우팅된다. 

그러나 다음과 같은 주의 사항이 있다. 

1. 테스트 

    ALB와 ECS가 올바르게 작동하는지 사전에 충분히 테스트 해야 한다. 

1. DNS 전파 지연

    DNS 업데이트는 즉시 전파되지 않을 수 있다. 일부 사용자는 변경 전의 엔드포인트로 트래픽이 라우팅 될 수 있으므로 업데이트 후에도 기존 서비스를 적어도 몇 시간 동안 실행 상태로 유지하는 것이 좋다. 

1. 롤백 계획

    문제가 발생할 경우를 대비하여 롤백 계획을 준비해야 한다. 예를 들어 새로운 서비스에 문제가 발생한 경우 Route 53 설정을 원래대로 돌릴 수 있어야 한다. 

