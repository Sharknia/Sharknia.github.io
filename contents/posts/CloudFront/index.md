---
tags:
  - AWS
update: "2024-02-01"
date: "2023-10-30"
상태: "Ready"
title: "CloudFront"
---
## Amazon CloudFront

아마존에서 제공하는 CDN(Content Delivery Network) 서비스이다. 

#### CDN이란?

사용자에게 웹 콘텐츠를 더 빠르게 제공하기 위해 전 세계 여러 위치에 콘텐츠를 분산 및 저장하는 네트워크이다.

## 주요 기능과 특징

#### 글로벌 엣지 네트워크

전 세계에 200개가 넘는 엣지 로케이션과 리전을 갖추고 있다. 

#### 동적 및 정적 콘텐츠 전송

정적 콘텐츠와 동적 콘텐츠를 모두 효과적으로 전송한다. 

#### 오리진 서버

배포를 생성할 때 오리진 서버를 지정해야 한다. 이 오리진은 S3 버킷, EC2 인스턴스, ELB, 외부 서버 등이 될 수 있다. 오리진에서 컨텐츠를 가져와 사용자에게 제공한다. 

#### 성능향상

CDN은 사용자에게 가까운 서버에서 콘텐츠를 제공하여 웹 사이트의 로딩시간을 단축시킨다. 

#### 가용성 및 장애 복구

여러 서버에 콘텐츠를 복사하므로, 한 서버에 문제가 발생하더라도 다른 서버에서 콘텐츠를 제공할 수 있다. 

#### 부하 분산

웹 트래픽을 여러 서버에 분산시켜 오리진 서버의 부하를 줄인다. 

#### 비용 절감

캐시된 콘텐츠를 제공함으로써 오리진 서버의 대역폭 사용량과 비용을 줄일 수 있다. 

#### 보안 향상

웹사이트에 대한 DDoS 공격과 같은 일부 보안 위협으로부터 보호할 수 있다. 

## 동작 플로우

1. 배포 생성

    사용자는 AWS Management Console, SDK, CLI 등을 사용하여 CloudFront 배포를 생성한다. 이 때, 오리진 서버(S3 버킷, EC2 인스턴스, HTTP 서버 등)와 다양한 배포 설정(예: 캐싱 동작, SSL 인증서, 액세스 제한 등)을 지정한다. 

1. DNS 등록

    CloudFront는 배포에 대해 고유한 도메인 이름을 제공한다. 사용자는 Route 53 같은 DNS 서비스를 사용해 이 도메인 이름을 웹 사이트나 애플리케이션에 연결할 수 있다. 

1. 사용자 요청

    사용자가 콘텐츠에 액세스 하기 위해 웹 브라우저나 애플리케이션으로 요청을 보내면 DNS 시스템은 해당 요청을 CloutFront 배포의 도메인 이름으로 Resolve 한다. 

1. 엣지 로케이션 라우팅

    요청은 사용자게에 가장 가까운 CloudFront 엣지 로케이션으로 라우팅된다. 

1. 캐시 확인

    해당 엣지 로케이션의 캐시에서 요청된 콘텐츠를 확인한다. 

    - 캐시에 콘텐츠가 있는 경우 (Cache Hit) : 캐시된 콘텐츠를 사용자에게 직접 반환한다. 

    - 캐시에 콘텐츠가 없는 경우 (Cache Miss) : CloudFront는 설정된 오리진 서버로 요청을 전달한다. 

1. 오리진에서 콘텐츠 가져오기

    오리진 서버에서 요청된 콘텐츠를 가져온다. 

1. 콘텐츠 반환 및 캐싱

    가져온 콘텐츠를 사용자에게 반환하면서 동시에 해당 콘텐츠를 엣지 로케이션의 캐시에 저장한다. 이후 동일한 콘텐츠에 대한 요청이 들어오면 캐시에서 빠르게 제공할 수 있다. 

1. 캐시 만료

    캐싱 동작은 TTL(Time to Live) 설정에 따라 관리된다. TTL이 만료되면 콘텐츠는 자동으로 캐시에서 제거된다. 다음 요청이 들어오면 다시 오리진에서 콘텐츠를 가져온다. 

## 동적 콘텐츠의 캐싱

동적 콘텐츠는 사용자별로 또는 시간에 따라 달라지는 콘텐츠를 의미한다. 예를 들면 사용자 프로필 페이지, 실시간 주식 시세, 뉴스 피드 등이 있을 수 있다. CDN 서비스들은 동적 콘텐츠를 캐싱하기 위해 특별한 전략을 사용한다. 

동적 콘텐츠 캐싱의 핵심 아이디어는 “모든 동적 콘텐츠가 항상 동적인 것은 아니다.”라는 점이다. 즉, 일부 동적 콘텐츠는 짧은 시간 동안에는 변하지 않을 수도 있다. 

캐시의 동작을 잘못 설정하면 데이터 베이스의 변경사항이 반영된 새로운 응답이 캐시에 저장되지 않을 수 있으므로, 그 결과로 사용자는 오래된 또는 기대하지 않은 응답을 받을 수 있다. 이런 문제를 피하기 위해 캐싱은 항상 주의해야 한다. 

캐싱 전략을 변경하거나 새로운 캐싱 매커니즘을 도입할 때에는 항상 테스트 환경에서 먼저 검증하는 것이 좋다. 

동적 콘텐츠를 캐싱하는 방법은 다음과 같다. 

### 조정 가능한 TTL

동적 콘텐츠에 대한 캐싱 정책의 TTL을 짧게 설정할 수 있다. 이렇게 하면 콘텐츠가 잠시동안만 캐싱되어 그 이후에는 다시 오리진에서 최신 데이터를 가져온다. 

### 캐시 키 매개변수

쿼리 문자열, 헤더, 쿠키 등의 요청 요소를 기반으로 캐시 버전을 구분할 수 있다. 이를 사용해 동일한 URL에 대한 다양한 버전의 콘텐츠를 캐싱할 수 있다. 

### 컨텐츠 기반의 캐싱 정책

오리진 서버는 `Cache-Control` 또는 `Expires` 헤더를 사용하여 콘텐츠의 캐싱 동작을 제어할 수 있다. 

#### Cache-Control 헤더

반환된 응답에 Cache-Control 헤더가 포함되어 있는 경우 이 헤더의 지시어를 따라 캐싱한다. 예를 들어 `Cache-Control: max-age=3600` 은 해당 응답을 1시간 동안 캐싱하라는 의미이다. 

또는 `Cache-Control: no-store` 나 `Cache-Control: private` 헤더를 포함하고 있으면 해당 응답은 캐싱되지 않는다. 

#### Expires 헤더

반환된 응답이 Expires 헤더를 포함하고 있으면 해당 시간까지 응답을 캐싱한다. 

### Lambda@Edge

Lambda@Egde를 이용하여 요청 및 응답을 가로채고 수정하여 캐싱 동작을 더욱 세밀하게 제어할 수 있다. 

### Bypass Cache

특정 조건 하에서 캐싱을 우회하고 항상 오리진 서버로 요청을 전달할 수 있다. 이렇게 하면 특정 요청에 대해서는 항상 최신의 동적 콘텐츠를 제공할 수 있다. 

### 데이터 변경 시 캐시 무효화

특정 콘텐츠의 캐시를 수동으로 무효화 하는 기능을 제공한다. 데이터베이스에 중요한 변경이 발생한 경우, 이 기능을 사용하여 해당 콘텐츠의 캐시를 즉시 제거할 수 있다. 



